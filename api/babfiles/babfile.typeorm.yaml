dir: ..

tasks:
  migration:generate:
    desc: Generate a new migration
    run:
      - prompt: name
        type: input
        message: "Migration name:"
        placeholder: "CreateUsersTable"
      - cmd: pnpm typeorm migration:generate src/database/migrations/${{ name }} -d src/database/data-source.ts

  migration:run:
    desc: Run pending migrations
    run:
      - cmd: pnpm typeorm migration:run -d src/database/data-source.ts

  migration:revert:
    desc: Revert last migration
    run:
      - cmd: pnpm typeorm migration:revert -d src/database/data-source.ts

  migration:status:
    desc: Show all migrations and their status
    run:
      - cmd: pnpm typeorm migration:show -d src/database/data-source.ts

  schema:sync:
    desc: Synchronize database schema (dev only)
    run:
      - prompt: confirm
        type: confirm
        message: "This will sync schema without migrations. Continue?"
        default: false
      - cmd: pnpm typeorm schema:sync -d src/database/data-source.ts

  schema:drop:
    desc: Drop all tables (dangerous)
    run:
      - prompt: confirm
        type: confirm
        message: "This will DROP ALL TABLES. Are you sure?"
        default: false
      - cmd: pnpm typeorm schema:drop -d src/database/data-source.ts
