includes:
  api:
    babfile: ./api/babfiles/babfile.api.yaml
  web:
    babfile: ./web/babfiles/babfile.web.yaml

tasks:

  check:
    desc: useful for pre commit checks
    run:
      - task: api:check
      - task: web:check

  docker:infra:
    desc: Start infrastructure only (postgres + minio + mailpit)
    run:
      - cmd: docker compose up -d postgres minio mailpit

  docker:up:
    desc: Start all services
    run:
      - cmd: docker compose up -d

  docker:build:
    desc: Build and start all services
    run:
      - cmd: docker compose up -d --build

  docker:down:
    desc: Stop all services
    run:
      - cmd: docker compose down

  docker:destroy:
    desc: Stop all services and remove volumes
    run:
      - prompt: confirm
        type: confirm
        message: "This will remove all data. Continue?"
        default: false
      - cmd: docker compose down -v

  docker:logs:
    desc: Show logs from all services
    run:
      - cmd: docker compose logs -f

  docker:logs:api:
    desc: Show logs from API service
    run:
      - cmd: docker compose logs -f api

  docker:logs:db:
    desc: Show logs from PostgreSQL service
    run:
      - cmd: docker compose logs -f postgres

  docker:logs:mail:
    desc: Show logs from Mailpit service
    run:
      - cmd: docker compose logs -f mailpit

  docker:logs:minio:
    desc: Show logs from MinIO service
    run:
      - cmd: docker compose logs -f minio

  docker:status:
    desc: Show running services
    run:
      - cmd: docker compose ps

  docker:restart:
    desc: Restart all services
    run:
      - cmd: docker compose restart

  docker:rebuild:api:
    desc: Rebuild and restart API service
    run:
      - cmd: docker compose up -d --build api
